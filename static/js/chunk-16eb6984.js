(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-16eb6984"],{"0f39":function(e,t,a){},"2a55":function(e,t,a){"use strict";a.r(t);a("ac6a"),a("6b54"),a("a481"),a("7f7f");var o={data:function(){return{currentPage:1,pagesize:10,currentLivingId:"",deviceList:[],defaultProps:{children:"children",label:"DeviceName"},formInline:{groups:""},rules:{DisplayName:[{required:!0,message:"变量名不能为空",trigger:"blur"},{min:0,max:50,message:"长度不能超过50字符",trigger:"blur"}],NodeAddress:[{required:!0,message:"地址不能为空",trigger:"blur"},{min:0,max:50,message:"长度不能超过50字符",trigger:"blur"}],NodeLength:[{validator:this.isNum}]},formNodeData:{},groupList:[],spotList:[],dialogFormVisible:!1,dynamicValidateFormModal:!1,dialogVisible:!1,dialogTitle:"",formType:""}},components:{EditableCell:a("9558").default},computed:{},methods:{selectRow:function(e,t,a){this.name=e.name},rowStyle:function(e){var t=e.row;return this.name===t.name?{"background-color":"rgb(255,255,255)",cursor:"pointer"}:{cursor:"pointer"}},isNum:function(e,t,a){if(""!==t&&void 0!==t){/^[0-9]*$/.test(t)?a():a(new Error("必须为数字"))}else a()},handleSizeChange:function(e){this.pagesize=e,console.log(this.pagesize)},handleCurrentChange:function(e){this.currentPage=e,console.log(this.currentPage)},handlerNode:function(e){var t=e.Id;this.getData(t)},getData:function(e){var t=this;this.$post("datalocation/data/getNode",{ParentId:e}).then((function(e){e.Successful?t.spotList=e.Data:t.$Message.error({message:e.ErrorMessage,duration:800})}))},getUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},ArrHasObj:function(e,t){var a=-1;return e.forEach((function(e,o){e.Id==t.Id&&(a=o)})),a},remove_Diot:function(e){var t=this;this.$confirm("确定要删除当前点位?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){t.$post("datalocation/data/delete",{Id:e.Id}).then((function(a){a.Successful?(t.getData(e.ParentId),t.$Message.success({message:"数据配置成功",duration:800})):t.$Message.error({message:"数据删除失败",duration:800})}))})).catch((function(){}))},edit_Diot:function(e){this.dialogTitle="编辑点位",this.formNodeData=e,this.formType="edit",this.dialogFormVisible=!0},addNode:function(){this.formNodeData={},this.formType="add",this.dialogTitle="创建点位",this.dialogFormVisible=!0},getChild:function(){var e=this.$refs.cascaderDevice.getCheckedNodes()[0].value;this.formNodeData.ParentId=e},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;"add"==t.formType?(t.formNodeData.Id=t.getUUID(),t.$post("datalocation/data/insert",t.formNodeData).then((function(e){e.Successful?(t.deviceList.length>0&&(t.currentLivingId=t.formNodeData.ParentId,console.log(t.currentLivingId),t.$nextTick((function(){this.$refs.deviceTree.setCurrentKey(this.currentLivingId)}))),console.log(t.formNodeData.ParentId),t.getData(t.formNodeData.ParentId),t.$Message.success({message:"数据配置成功",duration:800}),t.closeDialog()):t.$Message.error({message:e.ErrorMessage,duration:800})}))):t.$post("datalocation/data/update",t.formNodeData).then((function(e){e.Successful?(t.getData(t.formNodeData.ParentId),t.closeDialog(),t.$Message.success({message:"数据配置成功",duration:800})):t.$Message.error({message:e.ErrorMessage,duration:800})}))}))},resetForm:function(e){this.$refs[e].resetFields()},closeDialog:function(){this.dialogFormVisible=!1},initGroup:function(){var e=this;this.$get("device/data/getAllDevice").then((function(t){t.Successful?(e.deviceList=t.Data,e.deviceList.forEach((function(e){e.children=e.Childrens})),e.deviceList.length>0&&(e.currentLivingId=e.deviceList[0].Id,e.$nextTick((function(){this.$refs.deviceTree.setCurrentKey(this.currentLivingId)})))):e.$Message.error({message:t.ErrorMessage,duration:800})}))}},mounted:function(){var e=this;this.initGroup(),this.socket=new this.$socket(WGURL.ws,WGURL.wsPort),this.socket.createConnection(),this.socket.setNodeValue=function(t){e.spotList.forEach((function(e){e.Id==t.Id&&(e=Object.assign(e,t))}))}}},r=(a("efb3"),a("2877")),i=Object(r.a)(o,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container div_group",attrs:{id:"deviceEquipment"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{sm:9,md:7,lg:5}},[a("div",{staticClass:"device-left"},[a("div",{staticClass:"_tree"},[a("el-tree",{ref:"deviceTree",attrs:{"node-key":"Id",data:e.deviceList,props:e.defaultProps,"highlight-current":!0,"default-expand-all":""},on:{"node-click":e.handlerNode}})],1)])]),a("el-col",{attrs:{sm:15,md:17,lg:19}},[a("div",{staticClass:"device-right"},[a("div",{staticClass:"_search"},[a("el-button",{attrs:{size:"small",icon:"el-icon-plus",title:"添加"},on:{click:e.addNode}},[e._v("添加点位")])],1),a("div",{staticClass:"grid-content bg-purple div_groupTables"},[a("el-table",{ref:"doitTable",staticStyle:{width:"100%",height:"97%"},attrs:{height:"71vh","highlight-current-row":"","tooltip-effect":"dark","row-style":e.rowStyle,size:"mini","default-sort":{prop:"date",order:"descending"},data:e.spotList},on:{"row-click":e.selectRow}},[a("el-table-column",{attrs:{type:"index",width:"50",label:"序号",align:"center"}}),a("el-table-column",{attrs:{prop:"DisplayName",label:"变量名",align:"center"}}),a("el-table-column",{attrs:{prop:"NodePreStamp",label:"前戳",align:"center"}}),a("el-table-column",{attrs:{prop:"NodeAddress",label:"地址",align:"center"}}),a("el-table-column",{attrs:{prop:"NodeLength",label:"长度",align:"center"}}),a("el-table-column",{attrs:{prop:"Expressions",label:"表达式",align:"center"}}),a("el-table-column",{attrs:{prop:"Source",label:"原值",align:"center"}}),a("el-table-column",{attrs:{prop:"Sink",label:"点位值",align:"center"}}),a("el-table-column",{attrs:{prop:"Status",label:"点位状态",align:"center"}}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{color:"rgb(64, 158, 255)"},attrs:{type:"text",icon:"el-icon-edit",size:"small"},on:{click:function(a){return e.edit_Diot(t.row)}}},[e._v("编辑")]),a("el-button",{staticStyle:{color:"rgb(247, 137, 137)"},attrs:{type:"text",icon:"el-icon-delete",size:"small"},on:{click:function(a){return e.remove_Diot(t.row)}}},[e._v("删除")])]}}])})],1)],1)])])],1),e.dialogFormVisible?a("el-dialog",{directives:[{name:"dialogdrag",rawName:"v-dialogdrag"}],attrs:{visible:e.dialogFormVisible,width:"520px","append-to-body":!0,"modal-append-to-body":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[a("span",{domProps:{innerHTML:e._s(e.dialogTitle)}})]),a("el-form",{ref:"formID",staticClass:"demo-form",staticStyle:{margin:"0 30px"},attrs:{model:e.formNodeData,"label-position":"left","label-width":"120px",rules:e.rules}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"add"==e.formType,expression:"formType=='add'"}],attrs:{label:"设备",prop:"DeviceName"}},[a("el-cascader",{ref:"cascaderDevice",staticStyle:{width:"100%"},attrs:{options:e.deviceList,props:{value:"Id",label:"DeviceName"},"show-all-levels":!1},on:{change:function(t){return e.getChild()}}})],1),a("el-form-item",{attrs:{label:"变量名",prop:"DisplayName"}},[a("el-input",{model:{value:e.formNodeData.DisplayName,callback:function(t){e.$set(e.formNodeData,"DisplayName",t)},expression:"formNodeData.DisplayName"}})],1),a("el-form-item",{attrs:{label:"地址",prop:"NodeAddress"}},[a("el-input",{model:{value:e.formNodeData.NodeAddress,callback:function(t){e.$set(e.formNodeData,"NodeAddress",t)},expression:"formNodeData.NodeAddress"}})],1),a("el-form-item",{attrs:{label:"前戳",prop:"NodePreStamp"}},[a("el-input",{attrs:{placeholder:"如西门子PLC:DB50"},model:{value:e.formNodeData.NodePreStamp,callback:function(t){e.$set(e.formNodeData,"NodePreStamp",t)},expression:"formNodeData.NodePreStamp"}})],1),a("el-form-item",{attrs:{label:"长度",prop:"NodeLength"}},[a("el-input",{model:{value:e.formNodeData.NodeLength,callback:function(t){e.$set(e.formNodeData,"NodeLength",t)},expression:"formNodeData.NodeLength"}})],1),a("el-form-item",{attrs:{label:"表达式",prop:"Expressions"}},[a("el-input",{attrs:{placeholder:"进行简单的计算,raw表示原值参与计算"},model:{value:e.formNodeData.Expressions,callback:function(t){e.$set(e.formNodeData,"Expressions",t)},expression:"formNodeData.Expressions"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("formID")}}},[e._v("确定")]),a("el-button",{on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1):e._e()],1)}),[],!1,null,null,null);t.default=i.exports},efb3:function(e,t,a){"use strict";a("0f39")}}]);