(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6f5139c8"],{"8ee8":function(e,r,t){"use strict";t.r(r);t("ac6a"),t("5df3"),t("6b54"),t("a481"),t("b76a");var a={props:["formType","formData"],data:function(){return{isLook:!1,isEdit:!1,resourceType:[{value:"MQTT",label:"MQTT"},{value:"WebHook",label:"WebHook"}],formTypeData:{},ResourceParams:{},rules:{ResourceType:[{required:!0,message:"请至少选择一个资源类型",trigger:"blur"}],ResourceName:[{required:!0,message:"请输入资源名称",trigger:"blur"},{min:0,max:50,message:"长度不能超过50字符",trigger:"blur"}]},MQTT_rules:{MQTTIp:[{required:!0,message:"请输入IP",trigger:"blur"}],MQTTPort:[{required:!0,message:"请输入端口",trigger:"blur"},{validator:this.isNum}],MQTTTimeout:[{required:!0,message:"请输入超时时间",trigger:"blur"},{validator:this.isNum}]},HTTP_rules:{HTTPMethod:[{required:!0,message:"方法不能为空",trigger:"blur"}],HTTPUrl:[{required:!0,message:"请输入请求地址",trigger:"blur"}],ContentType:[{required:!0,message:"请求类型不能为空",trigger:"blur"}],ConnectTimeOut:[{required:!0,message:"请输入连接超时时间",trigger:"blur"},{validator:this.isNum}],ReqTimeOut:[{required:!0,message:"请输入请求超时时间",trigger:"blur"},{validator:this.isNum}],PoolSize:[{validator:this.isNum}]}}},components:{},mounted:function(){this.initData()},methods:{typeClick:function(e){"MQTT"===e?this.ResourceParams.Headers&&delete this.ResourceParams.Headers:this.ResourceParams.Headers||(this.ResourceParams.Headers=[{key:"",value:""}])},isNum:function(e,r,t){if(""!==r&&void 0!==r){/^[0-9]*$/.test(r)?t():t(new Error("必须为数字"))}else t()},addHeaders:function(e,r){""!==r.key&&this.ResourceParams.Headers.length===e+1&&this.ResourceParams.Headers.push({key:"",value:""})},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=16*Math.random()|0;return("x"==e?r:3&r|8).toString(16)}))},initData:function(){var e=this;if("look"==this.formType)this.$nextTick((function(){e.isLook=!0,e.isEdit=!0}));else{if("edit"!=this.formType)return void this.$nextTick((function(){e.isLook=!1,e.isEdit=!1}));this.$nextTick((function(){e.isLook=!1,e.isEdit=!0}))}this.formTypeData={ResourceType:this.formData.ResourceType,ResourceName:this.formData.ResourceName},this.formData.ResourceParams&&(this.ResourceParams=JSON.parse(this.formData.ResourceParams),"edit"==this.formType&&"WebHook"===this.formData.ResourceType&&this.ResourceParams.Headers.push({key:"",value:""}))},onSubmit:function(e){var r=this,t="",a=new Promise((function(e,t){r.$refs.resForm.validate((function(r){r&&e()}))})),s=new Promise((function(e,t){console.log(r.formTypeData.ResourceType),r.$refs[r.formTypeData.ResourceType+"Form"].validate((function(r){r&&e()}))}));Promise.all([a,s]).then((function(){"WebHook"===r.formTypeData.ResourceType?r.ResourceParams.Headers=r.ResourceParams.Headers.filter((function(e){return""!==e.key})):"MQTT"===r.formTypeData.ResourceType&&(r.ResourceParams.MQTTUid=void 0===r.ResourceParams.MQTTUid?"":r.ResourceParams.MQTTUid,r.ResourceParams.MQTTPwd=void 0===r.ResourceParams.MQTTPwd?"":r.ResourceParams.MQTTPwd,r.ResourceParams.MQTTTimeout=void 0===r.ResourceParams.MQTTTimeout?"":r.ResourceParams.MQTTTimeout),t=Object.assign(r.formTypeData,r.ResourceParams),r.formData.Id?t.Id=r.formData.Id:t.Id=r.uuid();var a={Id:t.Id,ResourceName:t.ResourceName,ResourceParams:"",ResourceType:t.ResourceType};delete t.ResourceName,delete t.ResourceType,delete t.Id,a.ResourceParams=JSON.stringify(t),e?(console.log(r.formTypeData.ResourceType),r.$post("resource/data/test",a).then((function(e){e.Successful?r.$Message.success({message:"连接测试成功！",duration:800}):r.$Message.error({message:"连接测试失败！",duration:800})}))):"add"==r.formType?r.$post("resource/data/insert",a).then((function(e){e.Successful?(r.$emit("closeWin",!1),r.$Message.success({message:"数据配置成功！",duration:800})):r.$Message.error({message:e.ErrorMessage,duration:800})})):r.$post("resource/data/update",a).then((function(e){e.Successful?(r.$emit("closeWin",!1),r.$Message.success({message:"数据配置成功！",duration:800})):r.$Message.error({message:e.ErrorMessage,duration:800})}))}))},onCancel:function(){this.$emit("closeWin",!1)}}},s=(t("c3f0"),t("2877")),o=Object(s.a)(a,(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{attrs:{id:"resourceManage"}},[t("el-form",{ref:"resForm",attrs:{"label-position":"top",rules:e.rules,"label-width":"80px",model:e.formTypeData}},[t("el-form-item",{attrs:{label:"资源类型",prop:"ResourceType"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{placeholder:"请选择",disabled:e.isEdit},on:{change:e.typeClick},model:{value:e.formTypeData.ResourceType,callback:function(r){e.$set(e.formTypeData,"ResourceType",r)},expression:"formTypeData.ResourceType"}},e._l(e.resourceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"success"},on:{click:function(r){return e.onSubmit(!0)}}},[e._v("测试连接")])],1),t("el-form-item",{attrs:{label:"资源名称",prop:"ResourceName"}},[t("el-input",{staticStyle:{width:"60%"},attrs:{readonly:e.isEdit},model:{value:e.formTypeData.ResourceName,callback:function(r){e.$set(e.formTypeData,"ResourceName",r)},expression:"formTypeData.ResourceName"}})],1)],1),t("el-form",{directives:[{name:"show",rawName:"v-show",value:"MQTT"===e.formTypeData.ResourceType,expression:"formTypeData.ResourceType === 'MQTT'"}],ref:"MQTTForm",attrs:{"label-width":"80px",inline:!0,rules:e.MQTT_rules,"label-position":"top",model:e.ResourceParams}},[t("el-divider"),t("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"MQTT服务器",prop:"MQTTIp"}},[t("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTIp,callback:function(r){e.$set(e.ResourceParams,"MQTTIp",r)},expression:"ResourceParams.MQTTIp"}})],1),t("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"端口",prop:"MQTTPort"}},[t("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTPort,callback:function(r){e.$set(e.ResourceParams,"MQTTPort",r)},expression:"ResourceParams.MQTTPort"}})],1),t("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"MQTT用户名",prop:"MQTTUid"}},[t("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTUid,callback:function(r){e.$set(e.ResourceParams,"MQTTUid",r)},expression:"ResourceParams.MQTTUid"}})],1),t("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"MQTT密码",prop:"MQTTPwd"}},[t("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTPwd,callback:function(r){e.$set(e.ResourceParams,"MQTTPwd",r)},expression:"ResourceParams.MQTTPwd"}})],1),t("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"超时(ms)",prop:"MQTTTimeout"}},[t("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTTimeout,callback:function(r){e.$set(e.ResourceParams,"MQTTTimeout",r)},expression:"ResourceParams.MQTTTimeout"}})],1)],1),t("el-form",{directives:[{name:"show",rawName:"v-show",value:"WebHook"===e.formTypeData.ResourceType,expression:"formTypeData.ResourceType === 'WebHook'"}],ref:"WebHookForm",attrs:{"label-width":"80px",inline:!0,rules:e.HTTP_rules,"label-position":"top",model:e.ResourceParams}},[t("el-divider"),t("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"请求方法",prop:"HTTPMethod"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:e.isLook},model:{value:e.ResourceParams.HTTPMethod,callback:function(r){e.$set(e.ResourceParams,"HTTPMethod",r)},expression:"ResourceParams.HTTPMethod"}},[t("el-option",{attrs:{label:"Get",value:"Get"}}),t("el-option",{attrs:{label:"Post",value:"Post"}})],1)],1),t("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"请求Url",prop:"HTTPUrl"}},[t("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.HTTPUrl,callback:function(r){e.$set(e.ResourceParams,"HTTPUrl",r)},expression:"ResourceParams.HTTPUrl"}})],1),t("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"Content-Type"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",prop:"ContentType",disabled:e.isLook},model:{value:e.ResourceParams.ContentType,callback:function(r){e.$set(e.ResourceParams,"ContentType",r)},expression:"ResourceParams.ContentType"}},[t("el-option",{attrs:{label:"application/json",value:"application/json"}}),t("el-option",{attrs:{label:"text/plain;charset=UTF-8",value:"text/plain;charset=UTF-8"}})],1)],1),t("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"连接超时时间(ms)",prop:"ConnectTimeOut"}},[t("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.ConnectTimeOut,callback:function(r){e.$set(e.ResourceParams,"ConnectTimeOut",r)},expression:"ResourceParams.ConnectTimeOut"}})],1),t("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"请求超时时间(ms)",prop:"ReqTimeOut"}},[t("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.ReqTimeOut,callback:function(r){e.$set(e.ResourceParams,"ReqTimeOut",r)},expression:"ResourceParams.ReqTimeOut"}})],1),t("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"池大小",prop:"PoolSize"}},[t("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.PoolSize,callback:function(r){e.$set(e.ResourceParams,"PoolSize",r)},expression:"ResourceParams.PoolSize"}})],1),t("div",{staticClass:"_kv_box"},[t("p",[e._v("请求头Header")]),t("el-table",{attrs:{data:e.ResourceParams.Headers}},[t("el-table-column",{attrs:{label:"key"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-input",{attrs:{size:"mini",readonly:e.isLook},on:{input:function(t){return e.addHeaders(r.$index,r.row)}},model:{value:r.row.key,callback:function(t){e.$set(r.row,"key",t)},expression:"scope.row.key"}})]}}])}),t("el-table-column",{attrs:{label:"value"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-input",{attrs:{size:"mini",readonly:e.isLook},model:{value:r.row.value,callback:function(t){e.$set(r.row,"value",t)},expression:"scope.row.value"}})]}}])})],1)],1)],1),t("el-form",[t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.isLook,expression:"!isLook"}],staticStyle:{width:"200px",margin:"0 auto"}},[t("el-button",{on:{click:e.onCancel}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.onSubmit(!1)}}},[e._v("确定")])],1)],1)],1)}),[],!1,null,null,null);r.default=o.exports},c3f0:function(e,r,t){"use strict";t("c5fa")},c5fa:function(e,r,t){}}]);