(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6f5139c8"],{"8ee8":function(e,t,a){"use strict";a.r(t);a("ac6a"),a("5df3"),a("6b54"),a("a481"),a("b76a");var s={props:["formType","formData"],data:function(){return{isLook:!1,isEdit:!1,resourceType:[{value:"MQTT",label:"MQTT"},{value:"WebHook",label:"WebHook"}],formTypeData:{},ResourceParams:{},rules:{ResourceType:[{required:!0,message:"请至少选择一个资源类型",trigger:"blur"}],ResourceName:[{required:!0,message:"请输入资源名称",trigger:"blur"},{min:0,max:50,message:"长度不能超过50字符",trigger:"blur"}]},MQTT_rules:{MQTTIp:[{required:!0,message:"请输入IP",trigger:"blur"}],MQTTPort:[{required:!0,message:"请输入端口",trigger:"blur"},{validator:this.isNum}],MQTTTimeout:[{validator:this.isNum}]},HTTP_rules:{HTTPMethod:[{required:!0,message:"方法不能为空",trigger:"blur"}],HTTPUrl:[{required:!0,message:"请输入请求地址",trigger:"blur"}],ContentType:[{required:!0,message:"请求类型不能为空",trigger:"blur"}],ConnectTimeOut:[{validator:this.isNum}],ReqTimeOut:[{validator:this.isNum}],PoolSize:[{validator:this.isNum}]}}},components:{},mounted:function(){this.initData()},methods:{typeClick:function(e){"MQTT"===e?this.ResourceParams.Headers&&delete this.ResourceParams.Headers:this.ResourceParams.Headers||(this.ResourceParams.Headers=[{key:"",value:""}])},isNum:function(e,t,a){if(""!==t&&void 0!==t){/^[0-9]*$/.test(t)?a():a(new Error("必须为数字"))}else a()},addHeaders:function(e,t){""!==t.key&&this.ResourceParams.Headers.length===e+1&&this.ResourceParams.Headers.push({key:"",value:""})},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},initData:function(){var e=this;if("look"==this.formType)this.$nextTick((function(){e.isLook=!0,e.isEdit=!0}));else{if("edit"!=this.formType)return void this.$nextTick((function(){e.isLook=!1,e.isEdit=!1}));this.$nextTick((function(){e.isLook=!1,e.isEdit=!0}))}this.formTypeData={ResourceType:this.formData.ResourceType,ResourceName:this.formData.ResourceName},this.formData.ResourceParams&&(this.ResourceParams=JSON.parse(this.formData.ResourceParams),"edit"==this.formType&&"WebHook"===this.formData.ResourceType&&this.ResourceParams.Headers.push({key:"",value:""}))},onSubmit:function(e){var t=this,a="",s=new Promise((function(e,a){t.$refs.resForm.validate((function(t){t&&e()}))})),r=new Promise((function(e,a){console.log(t.formTypeData.ResourceType),t.$refs[t.formTypeData.ResourceType+"Form"].validate((function(t){t&&e()}))}));Promise.all([s,r]).then((function(){"WebHook"===t.formTypeData.ResourceType?t.ResourceParams.Headers=t.ResourceParams.Headers.filter((function(e){return""!==e.key})):"MQTT"===t.formTypeData.ResourceType&&(t.ResourceParams.MQTTUid=void 0===t.ResourceParams.MQTTUid?"":t.ResourceParams.MQTTUid,t.ResourceParams.MQTTPwd=void 0===t.ResourceParams.MQTTPwd?"":t.ResourceParams.MQTTPwd,t.ResourceParams.MQTTTimeout=void 0===t.ResourceParams.MQTTTimeout?"":t.ResourceParams.MQTTTimeout),a=Object.assign(t.formTypeData,t.ResourceParams),t.formData.Id?a.Id=t.formData.Id:a.Id=t.uuid();var s={Id:a.Id,ResourceName:a.ResourceName,ResourceParams:"",ResourceType:a.ResourceType};delete a.ResourceName,delete a.ResourceType,delete a.Id,s.ResourceParams=JSON.stringify(a),e?(console.log(t.formTypeData.ResourceType),t.$post("resource/data/test",s).then((function(e){e.Successful?t.$Message.success({message:"连接测试成功！",duration:800}):t.$Message.error({message:"连接测试失败！",duration:800})}))):"add"==t.formType?t.$post("resource/data/insert",s).then((function(e){e.Successful?(t.$emit("closeWin",!1),t.$Message.success({message:"数据配置成功！",duration:800})):t.$Message.error({message:e.ErrorMessage,duration:800})})):t.$post("resource/data/update",s).then((function(e){e.Successful?(t.$emit("closeWin",!1),t.$Message.success({message:"数据配置成功！",duration:800})):t.$Message.error({message:e.ErrorMessage,duration:800})}))}))},onCancel:function(){this.$emit("closeWin",!1)}}},r=(a("c3f0"),a("2877")),o=Object(r.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"resourceManage"}},[a("el-form",{ref:"resForm",attrs:{"label-position":"top",rules:e.rules,"label-width":"80px",model:e.formTypeData}},[a("el-form-item",{attrs:{label:"资源类型",prop:"ResourceType"}},[a("el-select",{staticStyle:{width:"60%"},attrs:{placeholder:"请选择",disabled:e.isEdit},on:{change:e.typeClick},model:{value:e.formTypeData.ResourceType,callback:function(t){e.$set(e.formTypeData,"ResourceType",t)},expression:"formTypeData.ResourceType"}},e._l(e.resourceType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"success"},on:{click:function(t){return e.onSubmit(!0)}}},[e._v("测试连接")])],1),a("el-form-item",{attrs:{label:"资源名称",prop:"ResourceName"}},[a("el-input",{staticStyle:{width:"60%"},attrs:{readonly:e.isEdit},model:{value:e.formTypeData.ResourceName,callback:function(t){e.$set(e.formTypeData,"ResourceName",t)},expression:"formTypeData.ResourceName"}})],1)],1),a("el-form",{directives:[{name:"show",rawName:"v-show",value:"MQTT"===e.formTypeData.ResourceType,expression:"formTypeData.ResourceType === 'MQTT'"}],ref:"MQTTForm",attrs:{"label-width":"80px",inline:!0,rules:e.MQTT_rules,"label-position":"top",model:e.ResourceParams}},[a("el-divider"),a("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"MQTT服务器",prop:"MQTTIp"}},[a("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTIp,callback:function(t){e.$set(e.ResourceParams,"MQTTIp",t)},expression:"ResourceParams.MQTTIp"}})],1),a("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"端口",prop:"MQTTPort"}},[a("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTPort,callback:function(t){e.$set(e.ResourceParams,"MQTTPort",t)},expression:"ResourceParams.MQTTPort"}})],1),a("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"MQTT用户名",prop:"MQTTUid"}},[a("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTUid,callback:function(t){e.$set(e.ResourceParams,"MQTTUid",t)},expression:"ResourceParams.MQTTUid"}})],1),a("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"MQTT密码",prop:"MQTTPwd"}},[a("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTPwd,callback:function(t){e.$set(e.ResourceParams,"MQTTPwd",t)},expression:"ResourceParams.MQTTPwd"}})],1),a("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"超时(ms)",prop:"MQTTTimeout"}},[a("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.MQTTTimeout,callback:function(t){e.$set(e.ResourceParams,"MQTTTimeout",t)},expression:"ResourceParams.MQTTTimeout"}})],1)],1),a("el-form",{directives:[{name:"show",rawName:"v-show",value:"WebHook"===e.formTypeData.ResourceType,expression:"formTypeData.ResourceType === 'WebHook'"}],ref:"WebHookForm",attrs:{"label-width":"80px",inline:!0,rules:e.HTTP_rules,"label-position":"top",model:e.ResourceParams}},[a("el-divider"),a("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"请求方法",prop:"HTTPMethod"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:e.isLook},model:{value:e.ResourceParams.HTTPMethod,callback:function(t){e.$set(e.ResourceParams,"HTTPMethod",t)},expression:"ResourceParams.HTTPMethod"}},[a("el-option",{attrs:{label:"Get",value:"Get"}}),a("el-option",{attrs:{label:"Post",value:"Post"}})],1)],1),a("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"请求Url",prop:"HTTPUrl"}},[a("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.HTTPUrl,callback:function(t){e.$set(e.ResourceParams,"HTTPUrl",t)},expression:"ResourceParams.HTTPUrl"}})],1),a("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"Content-Type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",prop:"ContentType",disabled:e.isLook},model:{value:e.ResourceParams.ContentType,callback:function(t){e.$set(e.ResourceParams,"ContentType",t)},expression:"ResourceParams.ContentType"}},[a("el-option",{attrs:{label:"application/json",value:"application/json"}}),a("el-option",{attrs:{label:"text/plain;charset=UTF-8",value:"text/plain;charset=UTF-8"}})],1)],1),a("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"连接超时时间(ms)",prop:"ConnectTimeOut"}},[a("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.ConnectTimeOut,callback:function(t){e.$set(e.ResourceParams,"ConnectTimeOut",t)},expression:"ResourceParams.ConnectTimeOut"}})],1),a("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"请求超时时间(ms)",prop:"ReqTimeOut"}},[a("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.ReqTimeOut,callback:function(t){e.$set(e.ResourceParams,"ReqTimeOut",t)},expression:"ResourceParams.ReqTimeOut"}})],1),a("el-form-item",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{label:"池大小",prop:"PoolSize"}},[a("el-input",{attrs:{readonly:e.isLook},model:{value:e.ResourceParams.PoolSize,callback:function(t){e.$set(e.ResourceParams,"PoolSize",t)},expression:"ResourceParams.PoolSize"}})],1),a("div",{staticClass:"_kv_box"},[a("p",[e._v("请求头Header")]),a("el-table",{attrs:{data:e.ResourceParams.Headers}},[a("el-table-column",{attrs:{label:"key"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"mini",readonly:e.isLook},on:{input:function(a){return e.addHeaders(t.$index,t.row)}},model:{value:t.row.key,callback:function(a){e.$set(t.row,"key",a)},expression:"scope.row.key"}})]}}])}),a("el-table-column",{attrs:{label:"value"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"mini",readonly:e.isLook},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]}}])})],1)],1)],1),a("el-form",[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.isLook,expression:"!isLook"}],staticStyle:{width:"200px",margin:"0 auto"}},[a("el-button",{on:{click:e.onCancel}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit(!1)}}},[e._v("确定")])],1)],1)],1)}),[],!1,null,null,null);t.default=o.exports},c3f0:function(e,t,a){"use strict";a("c5fa")},c5fa:function(e,t,a){}}]);