(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6f6b0066"],{"3a33":function(e,t,i){"use strict";i("4071")},4071:function(e,t,i){},d351:function(e,t,i){"use strict";i.r(t);var o,a=i("ade3"),r=(i("6b54"),i("a481"),i("20d6"),i("ac6a"),i("7f7f"),i("9558")),s=Object(a.a)({data:function(){return{currentPage:1,pagesize:10,equipmentInfo_visible:!1,equipmentList:[],spotList:[],groupList:[],dialogFormVisible:!1,dialogDeviceGroupVisible:!1,dialogOpcDeviceConfigVisible:!1,dialogTitle:"",opcDeviceConfig:{Duration:"",OPCAddr:""},formData:{Id:"",Topic:"",DeviceName:"",Description:"",DriveId:"",DriveType:"",DeviceType:"",ParentId:""},formType:"",rules:{Topic:[{required:!0,message:"Topic不能为空",trigger:"blur"},{min:0,max:50,message:"长度不能超过50字符",trigger:"blur"}],DeviceName:[{required:!0,message:"名称不能为空",trigger:"blur"},{min:0,max:50,message:"长度不能超过50字符",trigger:"blur"}],ParentId:[{required:!0,message:"父级不能为空",trigger:"blur"}],DriveId:[{required:!0,message:"驱动不能为空",trigger:"blur"}],OPCAddr:[{required:!0,message:"驱动地址不能为空",trigger:"blur"},{min:0,max:50,message:"长度不能超过50字符",trigger:"blur"}],Duration:[{required:!0,message:"周期不能为空",trigger:"blur"},{validator:this.isNum}],Description:[{required:!1}]},DrivesType:[{key:"OPC",value:"OPC"},{key:"PLC",value:"PLC"}],form:{name:"",address:"",region:"",collectCycle:""},dialogVisible:!1,restaurants:[],state:"",DrivesName:[],DeviceGroup:[]}},mounted:function(){},components:{EditableCell:r.default},methods:(o={selectRow:function(e,t,i){this.name=e.name},rowStyle:function(e){var t=e.row;return this.name===t.name?{"background-color":"rgb(255,255,255)",cursor:"pointer"}:{cursor:"pointer"}},handleSizeChange:function(e){this.pagesize=e,console.log(this.pagesize)},isNum:function(e,t,i){if(console.log(t),""!==t&&void 0!==t){/^[0-9]*$/.test(t)?i():i(new Error("必须为数字"))}else i()},handleCurrentChange:function(e){this.currentPage=e,console.log(this.currentPage)},getDeviceGroup:function(){var e=this;0==this.DeviceGroup.length&&this.$get("device/data/getDeviceGroup").then((function(t){t.Successful?t.Data&&t.Data.forEach((function(t){e.DeviceGroup.push({DeviceGroupName:t.DeviceName,Id:t.Id})})):e.$Message.error({message:t.ErrorMessage,duration:800})}))},getAllData:function(){console.log(this.equipmentList)},handlerNode:function(e){this.spotList=e.spotList},save:function(e){this.$trim(e.label)?e.showInput=!1:this.$msgbox.alert("设备名称不能为空！","提示",{confirmButtonText:"确定",callback:function(e){}})},edit:function(e){e.showInput=!0},append:function(e){if("0"==e.id){var t={id:this.getUUID(),label:"",showInput:!0,spotList:[]};e.children||this.$set(e,"children",[]),e.children.push(t)}else{var i=this.ArrHasObj(this.equipmentList[0].children,e);-1!==i&&(console.log(this.equipmentList[0].children[i]),this.equipmentList[0].children[i].spotList.push({id:e.id,label:e.label,NodeInfo:"",NodeId:"",doitdata:"",doitstatus:""}),this.spotList=this.equipmentList[0].children[i].spotList)}},remove:function(e,t){var i=e.parent,o=i.data.children||i.data,a=o.findIndex((function(e){return e.id===t.id}));o.splice(a,1),this.spotList=[]},focus:function(e){e.currentTarget.select()},inp:function(e,t){t.label=e},alters:function(e,t){console.log(t.label),t.showInput=!t.showInput},getUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},ArrHasObj:function(e,t){var i=-1;return e.forEach((function(e,o){e.id==t.id&&(i=o)})),i},remove_Diot:function(e){var t=this.ArrHasObj(this.equipmentList[0].children,e);if(-1!==t){var i=this.equipmentList[0].children[t].spotList.indexOf(e);this.equipmentList[0].children[t].spotList.splice(i,1),this.spotList=this.equipmentList[0].children[t].spotList}},openEquipmentInfo:function(e){this.equipmentList=[],this.equipmentInfo_visible=!0,this.equipmentList.push({id:"0",label:e.GroupName,showInput:!1,children:[]});var t={id:this.getUUID(),label:e.equipment,showInput:!1,spotList:[]};this.equipmentList[0].children.push(t),this.spotList=[]},handleView:function(e,t){this.addOrEdit=!1,this.getCommitObj(t),this.getTypeIcon(e)},handleEdit:function(e,t){this.formData=t,this.formType="edit",this.dialogTitle="编辑分组",0==t.DeviceType?this.dialogDeviceGroupVisible=!0:this.dialogFormVisible=!0,this.getDeviceGroup()},handleDeviceConfig:function(e,t){var i=this;this.dialogTitle="设备参数配置",this.$post("device/config/getDeviceConfig",{DeviceId:t.Id}).then((function(e){e.Successful&&"OPCUA"==e.Data.DriveType&&(i.dialogOpcDeviceConfigVisible=!0,null==e.Data.ConfigJson?(i.opcDeviceConfig.Id="",i.opcDeviceConfig.DeviceId=t.Id,i.opcDeviceConfig.OPCAddr="",i.opcDeviceConfig.Duration="",i.formType="add"):(i.opcDeviceConfig=JSON.parse(e.Data.ConfigJson),i.opcDeviceConfig.Id=e.Data.Id,i.opcDeviceConfig.DeviceId=e.Data.DeviceId,i.formType="edit"))}))},handleDelete:function(e,t){var i=this;this.$confirm("确定删除设备，删除设备会同步删除设备配置及变量?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){i.$post("device/data/delete",{Id:t.Id}).then((function(e){e.Successful&&(i.initData(),i.DeviceGroup=[],i.$Message.success({message:"数据配置成功！",duration:800}))}))})).catch((function(){}))},deleteRow:function(e,t){t.splice(e,1)},querySearch:function(){},getCommitObj:function(){},getTypeIcon:function(){},handleSelectInput:function(){}},Object(a.a)(o,"querySearch",(function(e,t){var i=this.restaurants;t(e?i.filter(this.createFilter(e)):i)})),Object(a.a)(o,"createFilter",(function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}})),Object(a.a)(o,"handleSelect",(function(e){console.log(e)})),Object(a.a)(o,"handleIconClick",(function(e){console.log(e)})),Object(a.a)(o,"convertInUse",(function(e,t){return 0==e.DeviceType?"":0==e.InUse?"否":"是"})),Object(a.a)(o,"submitConfigForm",(function(e){var t=this;"add"==this.formType?this.$post("device/config/insert",{Id:this.getUUID(),DeviceId:this.opcDeviceConfig.DeviceId,ConfigJson:JSON.stringify({OPCAddr:this.opcDeviceConfig.OPCAddr,Duration:this.opcDeviceConfig.Duration})}).then((function(e){e.Successful?(t.closeDialog(),t.$Message.success({message:"数据配置成功！",duration:800})):t.$Message.error({message:e.ErrorMessage,duration:800})})):this.$post("device/config/update",{Id:this.opcDeviceConfig.Id,DeviceId:this.opcDeviceConfig.DeviceId,ConfigJson:JSON.stringify({OPCAddr:this.opcDeviceConfig.OPCAddr,Duration:this.opcDeviceConfig.Duration})}).then((function(e){e.Successful?(t.closeDialog(),t.$Message.success({message:"数据配置成功！",duration:800})):t.$Message.error({message:e.ErrorMessage,duration:800})}))})),Object(a.a)(o,"submitForm",(function(e){var t=this;this.$refs[e].validate((function(i){if(!i)return console.log("error submit!!"),!1;t.DrivesName.forEach((function(e){e.DriveId==t.formData.DriveId&&(t.formData.DriveName=e.DriveName)})),"add"==t.formType?(t.formData.Id=t.getUUID(),t.formData.GroupId=t.getUUID(),t.formData.DeviceType="formDevice"==e?1:0,t.$post("device/data/insert",t.formData).then((function(e){e.Successful?(t.initData(),t.closeDialog(),t.$Message.success({message:"数据配置成功！",duration:800})):t.$Message.error({message:e.ErrorMessage,duration:800})}))):t.$post("device/data/update",t.formData).then((function(e){e.Successful?(t.initData(),t.closeDialog(),t.$Message.success({message:"数据配置成功！",duration:800})):t.$Message.error({message:e.ErrorMessage,duration:800})}))}))})),Object(a.a)(o,"resetForm",(function(e){this.$refs[e].resetFields()})),Object(a.a)(o,"closeDialog",(function(){this.dialogFormVisible=!1,this.dialogDeviceGroupVisible=!1,this.dialogOpcDeviceConfigVisible=!1})),Object(a.a)(o,"closeDeviceGroupDialog",(function(){this.dialogOpcDeviceConfigVisible=!1})),Object(a.a)(o,"closeOpcDeviceConfigDialog",(function(){this.dialogOpcDeviceConfigVisible=!1})),Object(a.a)(o,"addDevice",(function(){this.formData={},this.formType="add",this.dialogTitle="创建设备",this.dialogFormVisible=!0,this.getDeviceGroup()})),Object(a.a)(o,"addDeviceGroup",(function(){this.formData={},this.formType="add",this.dialogTitle="创建设备组",this.dialogDeviceGroupVisible=!0})),Object(a.a)(o,"initData",(function(){var e=this;this.$get("device/data/getAllDevice").then((function(t){t.Successful?(e.groupList=t.Data,e.groupList.forEach((function(e){e.children=e.Childrens}))):e.$Message.error({message:t.ErrorMessage,duration:800})})),this.$get("drive/data/getAllDrive").then((function(t){t.Successful?e.DrivesName=t.Data:e.$Message.error({message:t.ErrorMessage,duration:800})}))})),o)},"mounted",(function(){this.initData()})),n=(i("3a33"),i("2877")),l=Object(n.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"div_group"},[i("el-button",{attrs:{size:"small",icon:"el-icon-plus",title:"添加"},on:{click:e.addDeviceGroup}},[e._v("添加设备组\n\t\t")]),i("el-button",{attrs:{size:"small",icon:"el-icon-plus",title:"添加"},on:{click:e.addDevice}},[e._v("添加设备\n\t\t")]),i("div",{staticClass:"div_groupTables"},[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%",height:"97%"},attrs:{"highlight-current-row":"",data:e.groupList.slice((e.currentPage-1)*e.pagesize,e.currentPage*e.pagesize),"tooltip-effect":"dark","default-sort":{prop:"date",order:"descending"},border:"",size:"mini","default-expand-all":"","row-key":"Id","tree-props":{children:"children",hasChildren:"hasChildren"},"row-style":e.rowStyle},on:{"row-click":e.selectRow}},[i("el-table-column",{attrs:{prop:"DeviceName",label:"名称"}}),i("el-table-column",{attrs:{prop:"Topic",label:"Topic"}}),i("el-table-column",{attrs:{prop:"Duration",label:"采集周期"}}),i("el-table-column",{attrs:{prop:"DriveName",label:"驱动名称"}}),i("el-table-column",{attrs:{prop:"InUse",label:"启用",formatter:e.convertInUse}}),i("el-table-column",{attrs:{prop:"Description",label:"描述"}}),i("el-table-column",{attrs:{prop:"CreaterBy",label:"创建者",width:"100"}}),i("el-table-column",{attrs:{prop:"CreateTime",label:"创建时间",sortable:"",width:"180"}}),i("el-table-column",{attrs:{fixed:"right",label:"设备参数",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[""!=t.row.ParentId&&null!=t.row.ParentId?i("el-button",{staticStyle:{color:"rgb(64,158,255)"},attrs:{type:"text",icon:"el-icon-edit",size:"mini"},on:{click:function(i){return e.handleDeviceConfig(t.$index,t.row)}}},[e._v("详情")]):e._e()]}}])}),i("el-table-column",{attrs:{fixed:"right",label:"操作",width:"240",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{staticStyle:{color:"rgb(64,158,255)","font-size":"14px"},attrs:{type:"text",icon:"el-icon-edit",size:"mini"},on:{click:function(i){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),i("el-button",{staticStyle:{color:"rgb(247,137,137)","font-size":"14px"},attrs:{type:"text",icon:"el-icon-delete",size:"mini"},on:{click:function(i){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e.dialogDeviceGroupVisible?i("el-dialog",{directives:[{name:"dialogdrag",rawName:"v-dialogdrag"}],attrs:{visible:e.dialogDeviceGroupVisible,"append-to-body":!0,width:"520px","modal-append-to-body":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogDeviceGroupVisible=t}}},[i("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[i("span",{domProps:{innerHTML:e._s(e.dialogTitle)}})]),i("el-form",{ref:"formDeviceGroup",staticClass:"demo-form",staticStyle:{margin:"0 30px"},attrs:{model:e.formData,rules:e.rules,"label-position":"left","label-width":"120px"}},[i("el-form-item",{attrs:{label:"设备组名称",prop:"DeviceName"}},[i("el-input",{model:{value:e.formData.DeviceName,callback:function(t){e.$set(e.formData,"DeviceName",t)},expression:"formData.DeviceName"}})],1),i("el-form-item",{attrs:{label:"采集周期(ms)",prop:"Duration"}},[i("el-input",{model:{value:e.formData.Duration,callback:function(t){e.$set(e.formData,"Duration",t)},expression:"formData.Duration"}})],1),i("el-form-item",{attrs:{label:" 描述",prop:"Description"}},[i("el-input",{model:{value:e.formData.Description,callback:function(t){e.$set(e.formData,"Description",t)},expression:"formData.Description"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("formDeviceGroup")}}},[e._v("确定")]),i("el-button",{on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1):e._e(),e.dialogFormVisible?i("el-dialog",{directives:[{name:"dialogdrag",rawName:"v-dialogdrag"}],attrs:{visible:e.dialogFormVisible,"append-to-body":!0,width:"520px","modal-append-to-body":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[i("span",{domProps:{innerHTML:e._s(e.dialogTitle)}})]),i("el-form",{ref:"formDevice",staticClass:"demo-form",staticStyle:{margin:"0 30px"},attrs:{model:e.formData,rules:e.rules,"label-position":"left","label-width":"120px"}},[i("el-form-item",{attrs:{label:"父级",prop:"ParentId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.formData.ParentId,callback:function(t){e.$set(e.formData,"ParentId",t)},expression:"formData.ParentId"}},e._l(e.DeviceGroup,(function(e){return i("el-option",{key:e.Id,attrs:{label:e.DeviceGroupName,value:e.Id}})})),1)],1),i("el-form-item",{attrs:{label:"Topic",prop:"Topic"}},[i("el-input",{model:{value:e.formData.Topic,callback:function(t){e.$set(e.formData,"Topic",t)},expression:"formData.Topic"}})],1),i("el-form-item",{attrs:{label:"设备名称",prop:"DeviceName"}},[i("el-input",{model:{value:e.formData.DeviceName,callback:function(t){e.$set(e.formData,"DeviceName",t)},expression:"formData.DeviceName"}})],1),i("el-form-item",{attrs:{label:"驱动名称",prop:"DriveId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.formData.DriveId,callback:function(t){e.$set(e.formData,"DriveId",t)},expression:"formData.DriveId"}},e._l(e.DrivesName,(function(e){return i("el-option",{key:e.Id,attrs:{label:e.DriveName,value:e.Id}})})),1)],1),i("el-form-item",{attrs:{label:"描述",prop:"Description"}},[i("el-input",{model:{value:e.formData.Description,callback:function(t){e.$set(e.formData,"Description",t)},expression:"formData.Description"}})],1),i("el-form-item",{attrs:{label:"状态",prop:"InUse"}},[i("el-switch",{staticStyle:{display:"block"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"启用","active-value":"1","inactive-value":"0","inactive-text":"关闭"},model:{value:e.formData.InUse,callback:function(t){e.$set(e.formData,"InUse",t)},expression:"formData.InUse"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("formDevice")}}},[e._v("确定")]),i("el-button",{on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1):e._e(),i("el-dialog",{directives:[{name:"dialogdrag",rawName:"v-dialogdrag"}],attrs:{visible:e.dialogOpcDeviceConfigVisible,"append-to-body":!0,width:"520px","modal-append-to-body":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogOpcDeviceConfigVisible=t}}},[i("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[i("span",{domProps:{innerHTML:e._s(e.dialogTitle)}})]),i("el-form",{ref:"formOpcDeviceConfig",staticClass:"demo-form",staticStyle:{margin:"0 30px"},attrs:{model:e.opcDeviceConfig,rules:e.rules,"label-position":"left","label-width":"120px"}},[i("el-form-item",{attrs:{label:"OPC地址",prop:"OPCAddr"}},[i("el-input",{model:{value:e.opcDeviceConfig.OPCAddr,callback:function(t){e.$set(e.opcDeviceConfig,"OPCAddr",t)},expression:"opcDeviceConfig.OPCAddr"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitConfigForm("formOpcDeviceConfig")}}},[e._v("确定")]),i("el-button",{on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1)],1)}),[],!1,null,"d9ee45a4",null);t.default=l.exports}}]);