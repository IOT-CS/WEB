(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-a8e80496"],{b750:function(e,t,n){},edc5:function(e,t,n){"use strict";n("b750")},f08a:function(e,t,n){"use strict";n.r(t);n("7f7f"),n("ac6a"),n("0fb7"),n("450d");var i=n("f529"),o=n.n(i),a=(n("6b54"),n("a481"),n("b76a")),s=n.n(a),l=(n("2dd9"),n("711e")),c=n("6c5d"),r=n("d49e"),d=n("eb35"),u=n("51a0"),f=n("8fe8"),m=n("2ef0"),h=n.n(m),p=(n("4bae"),n("75e9"),n("81a1")),b={props:["formType","nodeData"],data:function(){return{jsPlumb:null,easyFlowVisible:!0,flowInfoVisible:!1,loadEasyFlowFinish:!1,flowHelpVisible:!1,data:{},activeElement:{type:void 0,nodeId:void 0,sourceId:void 0,targetId:void 0,nodeSrcName:void 0,nodeSrcType:void 0,nodeTarName:void 0,nodeTarType:void 0},zoom:.5,menuData:[]}},mixins:[l.easyFlowMixin],components:{draggable:s.a,flowNode:c.default,nodeMenu:r.default,FlowInfo:d.default,FlowNodeForm:f.default,FlowHelp:u.default},directives:{flowDrag:{bind:function(e,t,n,i){t&&(e.onmousedown=function(t){if(2!=t.button){var n=t.clientX,i=t.clientY;e.style.cursor="move",document.onmousemove=function(t){t.preventDefault();var o=t.clientX-n;n=t.clientX,e.scrollLeft+=-o;var a=t.clientY-i;i=t.clientY,e.scrollTop+=-a},document.onmouseup=function(t){e.style.cursor="auto",document.onmousemove=null,document.onmouseup=null}}})}}},created:function(){},mounted:function(){var e=this;this.jsPlumb=jsPlumb.getInstance(),this.$nextTick((function(){"add"===e.formType||"addNew"===e.formType?(Object(p.getDefaultData)().RuleId=e.getUUID(),e.dataReload(Object(p.getDefaultData)())):e.dataReload(e.nodeData)}))},methods:{getUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},jsPlumbInit:function(){var e=this;this.jsPlumb.ready((function(){e.jsPlumb.importDefaults(e.jsplumbSetting),e.jsPlumb.setSuspendDrawing(!1,!0),e.loadEasyFlow(),e.jsPlumb.bind("click",(function(t,n){e.activeElement.type="line",e.activeElement.sourceId=t.sourceId,e.activeElement.targetId=t.targetId,e.$refs.nodeForm.lineInit({from:t.sourceId,to:t.targetId,sourceText:t.source.innerText,targetText:t.target.innerText,label:t.getLabel()})})),e.jsPlumb.bind("connection",(function(t){var n=t.source.id,i=t.target.id,o=t.source.innerText,a=t.target.innerText;e.loadEasyFlowFinish&&e.data.lineList.push({from:n,to:i,sourceText:o,targetText:a})})),e.jsPlumb.bind("connectionDetached",(function(t){e.deleteLine(t.sourceId,t.targetId),e.$refs.nodeForm.lineInit(!1)})),e.jsPlumb.bind("connectionMoved",(function(t){e.changeLine(t.originalSourceId,t.originalTargetId)})),e.jsPlumb.bind("contextmenu",(function(e){console.log("contextmenu",e)})),e.jsPlumb.bind("beforeDrop",(function(t){var n=t.sourceId,i=t.targetId;return n===i?(o.a.error("节点不支持连接自己"),!1):e.hasLine(n,i)?(o.a.error("该关系已存在,不允许重复创建"),!1):e.hashOppositeLine(n,i)?(o.a.error("不支持两个节点之间连线回环"),!1):(o.a.success("连接成功"),e.$refs.nodeForm.lineInit({from:t.sourceId,to:t.targetId,sourceText:t.source.innerText,targetText:t.target.innerText,label:t.getLabel()}),!0)})),e.jsPlumb.bind("beforeDetach",(function(e){console.log("beforeDetach",e)})),e.jsPlumb.setContainer(e.$refs.efContainer)}))},loadEasyFlow:function(){for(var e=0;e<this.data.nodeList.length;e++){var t=this.data.nodeList[e];this.jsPlumb.makeSource(t.id,h.a.merge(this.jsplumbSourceOptions,{})),this.jsPlumb.makeTarget(t.id,this.jsplumbTargetOptions),t.viewOnly||this.jsPlumb.draggable(t.id,{containment:"parent",stop:function(e){console.log("拖拽结束: ",e)}})}for(e=0;e<this.data.lineList.length;e++){var n=this.data.lineList[e],i={source:n.from,target:n.to,label:n.label?n.label:"",connector:n.connector?n.connector:"",anchors:n.anchors?n.anchors:void 0,paintStyle:n.paintStyle?n.paintStyle:void 0};this.jsPlumb.connect(i,this.jsplumbConnectOptions)}this.$nextTick((function(){this.loadEasyFlowFinish=!0}))},setLineLabel:function(e){var t=this.jsPlumb.getConnections({source:e.from,target:e.to})[0];e.label&&""!==e.label?t.addClass("flowLabel"):(t.removeClass("flowLabel"),t.addClass("emptyFlowLabel")),t.setLabel({label:e.label}),this.data.lineList.forEach((function(t){t.from==e.from&&t.to==e.to&&(t.label=e.label,t.sourceText=e.sourceText,t.targetText=e.targetText)}))},deleteElement:function(){var e=this;"node"===this.activeElement.type?"data_input"!=this.activeElement.nodeType&&this.deleteNode(this.activeElement.nodeId,this.activeElement.nodeName):"line"===this.activeElement.type&&this.$msgbox("确定删除所点击的线吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=e.jsPlumb.getConnections({source:e.activeElement.sourceId,target:e.activeElement.targetId})[0];e.jsPlumb.deleteConnection(t)})).catch((function(){}))},deleteLine:function(e,t){this.data.lineList=this.data.lineList.filter((function(n){return n.from!=e||n.to!=t}))},changeLine:function(e,t){this.deleteLine(e,t)},changeNodeSite:function(e){for(var t=0;t<this.data.nodeList.length;t++){var n=this.data.nodeList[t];n.id===e.nodeId&&(n.left=e.left,n.top=e.top)}},addNode:function(e,t,n){var i=e.originalEvent.clientX,a=e.originalEvent.clientY,s=this.$refs.efContainer,l=s.getBoundingClientRect(),c=i,r=a;if(c<l.x||c>l.width+l.x||r<l.y||l.y>l.y+l.height)o.a.error("请把节点拖入到画布中");else{c=c-l.x+s.scrollLeft,r=r-l.y+s.scrollTop,c-=85,r-=16;for(var d=this.getUUID(),u=t.name,f=u,m=1;m<1e4;){for(var h=!1,p=0;p<this.data.nodeList.length;p++){this.data.nodeList[p].name===f&&(f=u+m,h=!0)}if(!h)break;m++}var b={id:d,name:f,type:t.type,left:c+"px",top:r+"px",ico:t.ico,state:"success",style:t.style};this.data.nodeList.push(b),this.$nextTick((function(){this.jsPlumb.makeSource(d,this.jsplumbSourceOptions),this.jsPlumb.makeTarget(d,this.jsplumbTargetOptions),this.jsPlumb.draggable(d,{containment:"parent",stop:function(e){console.log("拖拽结束: ",e)}})}))}},deleteNode:function(e,t){var n=this;return this.$confirm("确定要删除节点[ "+t+" ]?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){n.data.nodeList=n.data.nodeList.filter((function(t){return t.id!==e})),n.$nextTick((function(){this.jsPlumb.removeAllEndpoints(e),this.$refs.nodeForm.nodeInit(!1,e)}))})).catch((function(){})),!0},clickNode:function(e){this.activeElement.type="node",this.activeElement.nodeId=e;var t="",n="";this.data.nodeList.forEach((function(i){i.id===e&&(t=i.name,n=i.type)})),this.activeElement.nodeName=t,this.activeElement.nodeType=n,this.$refs.nodeForm.nodeInit(this.data,e)},hasLine:function(e,t){for(var n=0;n<this.data.lineList.length;n++){var i=this.data.lineList[n];if(i.from===e&&i.to===t)return!0}return!1},hashOppositeLine:function(e,t){return this.hasLine(t,e)},nodeRightMenu:function(e,t){this.menu.show=!0,this.menu.curNodeId=e,this.menu.left=t.x+"px",this.menu.top=t.y+"px"},repaintEverything:function(e){this.data.nodeList.forEach((function(t){t.id,e.id})),this.jsPlumb.repaint()},dataInfo:function(){this.flowInfoVisible=!0,this.$nextTick((function(){this.$refs.flowInfo.init()}))},dataReload:function(e){var t=this;this.easyFlowVisible=!1,this.data.nodeList=[],this.data.lineList=[],this.$nextTick((function(){e=h.a.cloneDeep(e),t.easyFlowVisible=!0,t.data=e,t.$nextTick((function(){t.jsPlumb=jsPlumb.getInstance(),t.$nextTick((function(){t.jsPlumbInit()}))}))}))},zoomAdd:function(){this.zoom>=1||(this.zoom=this.zoom+.1,this.$refs.efContainer.style.transform="scale(".concat(this.zoom,")"),this.jsPlumb.setZoom(this.zoom))},zoomSub:function(){this.zoom<=0||(this.zoom=this.zoom-.1,this.$refs.efContainer.style.transform="scale(".concat(this.zoom,")"),this.jsPlumb.setZoom(this.zoom))},downloadData:function(){var e=this;this.$confirm("确定要下载该流程数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){var t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e.data,null,"\t")),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","data.json"),n.click(),n.remove(),o.a.success("正在下载中,请稍后...")})).catch((function(){}))},openHelp:function(){this.flowHelpVisible=!0,this.$nextTick((function(){this.$refs.flowHelp.init()}))},openEditBar:function(){this.$refs.nodeForm.setCollapse()},closeRuleWin:function(){this.$emit("closeRuleDialog",!1)},submitRule:function(){var e=this;"add"==this.formType||"addNew"==this.formType?this.$post("rule/data/insert",this.data).then((function(t){t.Successful?(e.$emit("closeRuleDialog",!1),e.$Message.success({message:"数据配置成功",duration:800})):e.$msgbox.alert(t.ErrorMessage,"错误提示",{confirmButtonText:"确定",callback:function(e){}})})):this.$post("rule/data/update",this.data).then((function(t){t.Successful?(e.$emit("closeRuleDialog",!1),e.$Message.success({message:"数据配置成功",duration:800})):e.$msgbox.alert(t.ErrorMessage,"错误提示",{confirmButtonText:"确定",callback:function(e){}})}))}}},g=(n("edc5"),n("2877")),x=Object(g.a)(b,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.easyFlowVisible?n("div",{staticStyle:{height:"calc(80vh)"}},[n("el-row",[n("el-col",{attrs:{span:24}},[n("div",{staticClass:"ef-tooltar"},[n("el-button",{attrs:{size:"mini",icon:"el-icon-delete",disabled:!this.activeElement.type},on:{click:e.deleteElement}},[e._v("删除节点/线")]),n("div",{staticStyle:{float:"right","margin-right":"5px"}},[n("el-input",{staticStyle:{width:"240px","margin-right":"20px"},attrs:{type:"text",placeholder:"请输入规则名称",size:"small",maxlength:"10"},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}},[n("template",{slot:"prepend"},[e._v("规则名称")])],2),n("el-button",{attrs:{type:"info",plain:"",round:"",icon:"el-icon-document",size:"mini"},on:{click:e.dataInfo}},[e._v("流程信息")]),n("el-button",{attrs:{type:"info",plain:"",round:"",icon:"el-icon-document",size:"mini"},on:{click:e.openHelp}},[e._v("帮助")]),n("el-button",{attrs:{type:"primary",plain:"",round:"",icon:"el-icon-edit",size:"mini"},on:{click:e.openEditBar}},[e._v("编辑栏")]),n("el-button",{attrs:{type:"success",round:"",icon:"el-icon-position",size:"mini"},on:{click:e.submitRule}},[e._v("发布")]),"addNew"!=e.formType?n("el-button",{attrs:{type:"danger",round:"",icon:"el-icon-close",size:"mini"},on:{click:e.closeRuleWin}},[e._v("关闭")]):e._e()],1)],1)])],1),n("div",{staticStyle:{display:"flex",height:"calc(100% - 47px)"}},[n("div",{staticStyle:{width:"230px","border-right":"1px solid #dce3e8","background-color":"#dce3e8"}},[n("node-menu",{ref:"nodeMenu",on:{addNode:e.addNode}})],1),n("div",{directives:[{name:"flowDrag",rawName:"v-flowDrag"}],ref:"efContainer",staticClass:"container",attrs:{id:"efContainer"}},[e._l(e.data.nodeList,(function(t){return[n("flow-node",{key:t.id,attrs:{id:t.id,node:t,activeElement:e.activeElement},on:{changeNodeSite:e.changeNodeSite,nodeRightMenu:e.nodeRightMenu,clickNode:e.clickNode}})]})),n("div",{staticStyle:{position:"absolute",top:"2000px",left:"2000px"}},[e._v(" ")])],2),n("div",{ref:"collWidth",staticClass:"flow-node-form-wrapper"},[n("flow-node-form",{ref:"nodeForm",on:{setLineLabel:e.setLineLabel,repaintEverything:e.repaintEverything}})],1)]),e.flowInfoVisible?n("flow-info",{ref:"flowInfo",attrs:{data:e.data}}):e._e(),e.flowHelpVisible?n("flow-help",{ref:"flowHelp"}):e._e()],1):e._e()}),[],!1,null,"14019f18",null);t.default=x.exports}}]);